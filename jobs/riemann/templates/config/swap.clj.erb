(info "Loading swap alerts")

(defn swap-alerts [pd]
  (info "Setting up swap alerts")
    (where
      (service "swap/swap-free")
        (pipe -
          (splitp > metric
            <%= p("riemann.swap.critical") %> (with :state "critical" -)
            <%= p("riemann.swap.warn") %> (with :state "warn" -)
                       (with :state "ok" -))
          (changed-state {:init "ok"} (where (state "ok") (:resolve pd)
                                        (else (where (state "critical") (:trigger pd)
                                        (else (where (state "warn") #(warn "SWAP SPACE IS LOW" %))))))))))

