(info "Loading awslogs alerts")

(defn awslogs-alerts [pd]
  (info "Setting up awslogs alerts")
  (sdo
    <% p("riemann.awslogs.metrics").each do |metric| %>
    (where
      (service #"<%= metric["service"] %>*")
        (changed :metric
          (where (> (- (System/currentTimeMillis) metric) (* <%= metric["threshold"] %> 1000))
            (:trigger pd)
            (else (:resolve pd)))))
    <% end %>
  )
)
