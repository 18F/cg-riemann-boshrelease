(info "Loading AWSLOGS alerts")

<% p("riemann.awslogs.metrics").each do |metric| %>
(defn awslogs-alert-<%= metric["service"] %> [pd]
  (info "Setting up AWSLOGS alerts")
  (where
    (service #"<%= metric["service"] %>*")
      (changed :metric
        (where (> (- (System/currentTimeMillis) metric) (* <%= p(metric["threshold"]) %> 1000))
          (:trigger pd)
          (else (:resolve pd))))))
<% end %>
